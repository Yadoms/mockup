class Yadoms{components={};pages=[];$style=null;masis=null;masisMove=null;masisResize=null;masisDelete=null;breakpoints={width:[],height:[]};maxCardWidthSize=5;maxCardHeightSize=5;positionOptions={pad:154};constructor(){console.log("  __ __       _                \n |  |  |___ _| |___ _____ ___  \n |_   _| .'| . | . |     |_ -| \n   |_| |__,|___|___|_|_|_|___| \n \n Welcome to the dev world!\n To have any help, type Yadoms.help() "),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&Yadoms.changeTheme("dark"),this.$style=document.createElement("style"),document.querySelector("head").appendChild(this.$style)}static help(e=""){""!=e?"changeTheme"==e&&(console.log("List of available themes"),console.table(["light","dark","lidrea"])):""==e?(console.log("List of available functions"),console.table({"Yadoms.lightOn()":"Change the current theme to the light mode","Yadoms.lightOff()":"Change the current theme to the dark mode","Yadoms.changeTheme(theme)":"Change the current theme to a specific theme"}),console.log("To have more information about a function, gives the name of the function in parameter."),console.info("Example : yadoms.help('changeTheme').")):console.log("no documentation for this function")}static lightOn(){return Yadoms.changeTheme("")}static lightOff(){return Yadoms.changeTheme("dark")}static changeTheme(e){return""==e&&(e="light"),document.querySelector('link[id="theme"]').href=`/css/${e}.min.css`,"The theme is set to "+e+" now"}static ready(e){"loading"!=document.readyState?e():document.addEventListener("DOMContentLoaded",e)}static triggerEvent(e,t={}){if(window.CustomEvent&&"function"==typeof window.CustomEvent)var a=new CustomEvent(e,{detail:t});else(a=document.createEvent("CustomEvent")).initCustomEvent(e,!0,!0,t);document.dispatchEvent(a)}createMenu(){const e=document.querySelector("nav#menu ul");this.pages.forEach(t=>{let a=document.createElement("li");a.innerHTML=`\n        <a\n          class="text-primaryColor hover:text-highlightColor"\n          href="#/${t.slug}"\n        >\n          <span class="icon">\n            <i class="fas fa-${t.icon}"></i>\n          </span>\n          <span class="word md:pb-0">${t.name}</span>\n        </a>\n      `,e.appendChild(a)})}createNavigationSystem(){let e=document.querySelectorAll("nav#menu ul li a");var t=this;e.forEach(e=>{e.addEventListener("click",e=>{e.stopImmediatePropagation(),t.viewPage(e.currentTarget.getAttribute("href").slice(2))},!1)})}createCard(e,t,a="",s="",i=-1,n=-1){let o=document.createElement("div");o.classList.add("card","text-primaryColor","bg-baseColor");let r="",d="";if(-1!=i){let e="";0==i?e="empty red":.25==i?e="quarter":.5==i?e="half":.75==i?e="three-quarters":1==i&&(e="full text-green-600"),r=`<span class="icon"><i class="fas fa-battery-${e}"></i></span>`}if(-1!=n){let e="";n<.5&&(e="red"),d=`<span class="icon"><i class="fas fa-wifi ${e}"></i></span>`}return o.innerHTML=`\n      <div class="card-title clearfix card-width-${e}">\n        ${r}\n        ${d}\n        <span class="title">${a}</span>\n      </div>\n      <div class="card-wrapper flex-grow">\n        <div class="card-width-${e} card-height-${t}">\n          ${s}\n        </div>\n      </div>\n    `,o}static changeCardTitle(e,t){let a=e.querySelector(".card-title");a.querySelector(".title").innerHTML=t,""==t?a.classList.add("no-border"):a.classList.remove("no-border")}createCardManagementSystem(){this.masis=new Masis("#cards");let e=this;for(let e=1;e<=Math.max(this.maxCardWidthSize,this.maxCardHeightSize);e++){const t=this.createCard(Math.min(e,this.maxCardWidthSize),Math.min(e,this.maxCardHeightSize));document.querySelector("#cards").appendChild(t);const a=getComputedStyle(t),s=t.getBoundingClientRect();let i,n;i=parseInt(s.width)+parseInt(a.marginLeft)+parseInt(a.marginRight),n=parseInt(s.height)+parseInt(a.marginTop)+parseInt(a.marginBottom),this.breakpoints.width.push(i),this.breakpoints.height.push(n),document.querySelector("#cards").removeChild(t)}this.masisMove=new MasisMove(this.masis,{class:"🏄",ghost:"👻",exclude:"🤖"});const t=(e,t,a,s=!1)=>{for(let t=1;t<6;t++)e.classList.remove(`card-width-${t}`),s&&e.classList.remove(`card-height-${t}`);e.classList.add(`card-width-${t}`),s&&e.classList.add(`card-height-${a}`)};this.masisResize=new MasisResize(this.masis,{class:"📐",active:"📜",selector:".card-wrapper > div",breakpoints:this.breakpoints,callbackMove:(a,s,i)=>{let n=parseInt(s)+parseInt(a.dataset.cardWidth),o=parseInt(i)+parseInt(a.dataset.cardHeight);n<parseInt(a.dataset.cardMinWidth)&&(n=parseInt(a.dataset.cardMinWidth)),o<parseInt(a.dataset.cardMinHeight)&&(o=parseInt(a.dataset.cardMinHeight)),n>e.maxCardWidthSize&&(n=e.maxCardWidthSize),o>e.maxCardHeightSize&&(n=e.maxCardHeightSize),t(a.querySelector(".card-title"),n,o),t(a.querySelector(".card-wrapper > div"),n,o,!0),a.dataset.cardTmpWidth=n,a.dataset.cardTmpHeight=o,MasisPosition(e.masis)},callbackEnd:e=>{e.dataset.cardWidth=e.dataset.cardTmpWidth,e.dataset.cardHeight=e.dataset.cardTmpHeight}}),this.masisDelete=new MasisDelete(this.masis,{class:"🗑️",message:"Etes-vous sûr de vouloir supprimer cette tuile ?"}),MasisPosition(this.masis,this.positionOptions),new ResizeObserver(e=>{MasisPosition(this.masis,this.positionOptions)}).observe(document.querySelector("#cards"));let a=!1;document.querySelector("#button-design").addEventListener("click",t=>{t.preventDefault(),a=!a,t.currentTarget.classList.remove("active"),a?(t.currentTarget.classList.add("active"),e.masis.$children.forEach(e=>{e.classList.add("🏄")})):e.masis.$children.forEach(e=>{e.classList.remove("🏄")})},!1)}viewPage(e){for(let t of this.pages)if(t.slug==e){if(""!=t.background){document.querySelector("#illustration .cover").style.backgroundImage=`url(${t.background})`}document.querySelectorAll("#menu a").forEach(e=>{e.parentNode.classList.remove("active"),e.getAttribute("href")==`#/${t.slug}`&&e.parentNode.classList.add("active")}),this.populate(t.cards);break}}generateCard(e){let t=this.createCard(e.width,e.height,e.title,this.components[e.type].render(e.properties),null!=typeof e.battery?e.battery:-1,null!=typeof e.signal?e.signal:-1);t.classList.add("ease-in-expo"),t.dataset.cardWidth=e.width,t.dataset.cardMinWidth=e.minWidth,t.dataset.cardHeight=e.height,t.dataset.cardMinHeight=e.minHeight,t.dataset.sort=MasisMove.joliNumber(e.index),document.querySelector("#cards").appendChild(t),this.components[e.type].init(t)}populate(e){document.querySelector("#cards").innerHTML="";let t=this,a=[];e.forEach(e=>{a.push(new Promise(a=>{Yadoms._loadComponent(e.type).then(()=>{t.generateCard(e),a()})}))}),Promise.all(a).then(()=>{this.masis.populate(),MasisSort(this.masis,"[data-sort]"),this.masisMove.init(),this.masisResize.init(),this.masisDelete.init(),MasisPosition(this.masis)})}static makeDigital(e,t=!0,a="8.8.8.8.8.8.8.8."){return t?`\n        <div class="digital">\n          <span class="hollow font-mono">${a}</span>\n          <span class="digits font-mono">${e}</span>\n        </div>\n      `:`\n        <div class="digital">\n          <span class="digits">${e}</span>\n        </div>\n      `}static _load(e,t){return new Promise((a,s)=>{let i=document.createElement(e),n="body",o="src";switch(i.onload=function(){a(t)},i.onerror=function(){s(t)},e){case"script":i.async=!0;break;case"link":i.type="text/css",i.rel="stylesheet",o="href",n="head"}i[o]=t,"body"==n?document[n].appendChild(i):document[n].insertBefore(i,document[n].firstChild)})}static loader(...e){const t=[];return e.forEach(e=>{e.endsWith(".js")&&t.push(Yadoms._load("script",e)),e.endsWith(".css")&&t.push(Yadoms._load("link",e))}),Promise.all(t)}static _loadComponent(e){return new Promise(t=>{Object.keys(window.yadoms_app.components).includes(e)?t(window.yadoms_app.components[e]):import(`/components/${e}.mjs`).then(a=>{if(!Object.keys(window.yadoms_app.components).includes(e)){let t=new a.YadomsComponent;window.yadoms_app.components[e]=t,window.yadoms_app.$style.textContent+=t.style()}t(window.yadoms_app.components[e])})})}static useComponent(e,t){let a=`_${e}_${Date.now()}`;return Yadoms._loadComponent(e).then(e=>{document.querySelector(`#${a}`).innerHTML=e.render(t)}),`<div id="${a}"></div>`}}window.yadoms_app=new Yadoms,Yadoms.ready(()=>{fetch("/yadoms.instance.json").then(e=>e.json()).then(e=>{window.yadoms_app.pages=e.instance.pages,window.yadoms_app.createMenu(),window.yadoms_app.createNavigationSystem(),window.yadoms_app.createCardManagementSystem(),window.yadoms_app.viewPage(window.location.hash.slice(2))})});
class MasisDelete{Masis=null;options={};constructor(e,s){this.Masis=e,this.options=s}init(){let e=this;this.Masis.$children.forEach(s=>{let t=document.createElement("div");t.classList.add(e.options.class),t.addEventListener("mousedown",s=>{e.removeChild(s)},!1),s.appendChild(t)})}removeChild(e){e.preventDefault(),e.stopImmediatePropagation(),confirm(this.options.message)&&(Yadoms.triggerEvent("masis.delete",{element:e.currentTarget.parentNode}),this.Masis.$element.removeChild(e.currentTarget.parentNode),MasisPosition(this.Masis.populate()))}}
class Masis{constructor(t){let e,n;e=document.querySelectorAll(t),n=[];let i=this;return e.forEach(t=>n.push(i._init(t))),0==n.length?null:1===n.length?n[0]:n}_init(t){return this.$element=t,this.populate()}populate(){this.$children=[];let t=this.$element.children;return Array.from(t).forEach(t=>{8!==t.nodeType&&this.$children.push(t)}),this.$actives=this.$children,this.view()}view(t=0,e=0){return t=parseInt(t),this.$children.forEach(t=>{t.style.display="none"}),this.$actives.forEach((n,i)=>{(!t||t&&e<=i&&i<t+e)&&(n.style.display="")}),this}}const _Masis=Masis;function MasisFilter(t,e="*"){if("*"!=e){let n=function(t,e){return(t.matches||t.matchesSelector||t.msMatchesSelector||t.mozMatchesSelector||t.webkitMatchesSelector||t.oMatchesSelector).call(t,e)},i=[];return t.$actives.forEach(t=>{n(t,e)&&i.push(t)}),t.$actives=i,t.view()}t.$actives=t.$children}function MasisLazy(t,e=0,n="data-src",i=null){window.innerHeight||document.documentElement.clientHeight;let r=()=>{t.$element.querySelectorAll("img["+n+"]").array.forEach(t=>{let r=t.getBoundingClientRect().top;if(-e<=r-e&&r<=wheight)return t.setAttribute("src",t.getAttribute(n)),t.removeAttribute(n),t.style.opacity=1,t.addEventListener("load",(function(){if(null!=i)return i(t)}),!1)})},l=null;return window.addEventListener("scroll",(function(){clearTimeout(l),l=setTimeout((function(){r()}),10)}),!1),r(),this}function MasisPosition(t,e={}){null==e.pad&&(e.pad=1);let n=parseInt(t.$element.offsetWidth);t.$element.style.position="relative";let i=[];for(let t=0;t<n;t++)i[t]=0;let r=function(t,n,i){let r=0,l=i[t];for(;(r+=e.pad)<n;)l<i[t+r]&&(l=i[t+r]);return l};return t.$actives.forEach(t=>{t.style.position="absolute";const l=getComputedStyle(t),s=t.getBoundingClientRect();let o,a;o=parseInt(s.width)+parseInt(l.marginLeft)+parseInt(l.marginRight),a=parseInt(s.height)+parseInt(l.marginTop)+parseInt(l.marginBottom);let c=0,h=0,u=1/0,p=u;for(;h<=n;){let t=h-e.pad,l=h+o;for(;t++<=l;){t+o<=n&&(p=a+r(t,o,i),u>p&&(u=p,c=t))}h+=o}for(t.style.left=c+"px",t.style.top=u-a+"px",h=o;h--;)i[h+c]=u}),t.$element.style.height=Math.max.apply(Math,i)+"px",t}function MasisSort(t,e="text",n="ASC"){n=n.toUpperCase();let i=Array.from(t.$children);i.sort((t,i)=>{const r=e.slice(1,-1);let l="text"!==e?t.getAttribute(r):t.innerHTML,s="text"!==e?i.getAttribute(r):i.innerHTML;return null==l&&(l=""),null==s&&(s=""),("ASC"===n?1:-1)*l.localeCompare(s)});for(let e=0;e<i.length;e++)t.$element.appendChild(i[e]);return t.populate()}
class MasisMove{Masis=null;options={};$ghost;positions;oldpos="";onDrag=!1;constructor(t,s={}){this.Masis=t,null==s.attr&&(s.attr="data-sort"),null==s.ghost&&(s.ghost="ghost"),this.options=s;let e=this;document.addEventListener("mousemove",t=>{e.moveGhost(t)},!1),this.redefineSort()}init(){let t=this;this.Masis.$children.forEach(s=>{s.addEventListener("mousedown",s=>{t.createGhost(s)},!1),s.addEventListener("mouseup",s=>{t.removeGhost(s)},!1)})}static pad(t,s,e){return e=e||"0",(t+="").length>=s?t:new Array(s-t.length+1).join(e)+t}static joliNumber(t){return`_${MasisMove.pad(t,6,"0")}`}redefineSort(){this.Masis.$children.forEach((t,s)=>{t.setAttribute(this.options.attr,MasisMove.joliNumber(s+1))})}generatePositionsMap(){this.positions={};let t=this;this.Masis.$children.forEach(s=>{let e=MasisMove.joliNumber(s.style.top.replace("px","")),i=MasisMove.joliNumber(s.style.left.replace("px",""));void 0===t.positions[e]&&(t.positions[e]={}),t.positions[e][i]=s.getAttribute(t.options.attr)})}createFake(t){let s=this.Masis.$element.querySelector("#"+this.options.exclude);null!=s&&this.Masis.$element.removeChild(s),s=document.createElement("div"),s.setAttribute("id",this.options.exclude),s.classList=this.$ghost.classList,s.classList.remove(this.options.ghost),s.innerHTML=this.$ghost.innerHTML,s.setAttribute(this.options.attr,t),this.Masis.$element.appendChild(s)}moveGhost(t){if(!this.onDrag)return;t.preventDefault();let s=t.pageX,e=t.pageY;s-=90,e-=50,this.$ghost.style.left=s+"px",this.$ghost.style.top=e+"px";let i=MasisMove.joliNumber(s),o=MasisMove.joliNumber(e);if(null!=this.positions){let t=Object.keys(this.positions).reverse(),s=MasisMove.joliNumber(0);for(let e in t)if(-1==t[e].localeCompare(o)){let o=Object.keys(this.positions[t[e]]).reverse();for(let a in o)if(-1==o[a].localeCompare(i)){s=MasisMove.joliNumber(parseInt(this.positions[t[e]][o[a]].replace("_","")))+"_";break}break}s!=this.oldpos&&(this.createFake(s),MasisPosition(MasisSort(this.Masis.populate(),"[data-sort]")),this.oldpos=s)}}createGhost(t){t.currentTarget.classList.contains(this.options.exclude)||t.currentTarget.classList.contains(this.options.class)&&(this.onDrag=!0,this.$ghost=event.currentTarget,this.Masis.$element.parentNode.appendChild(this.$ghost),this.$ghost.classList.add(this.options.ghost),this.createFake(this.$ghost.getAttribute(this.options.attr)),MasisPosition(MasisSort(this.Masis.populate(),"[data-sort]")),this.generatePositionsMap())}removeGhost(t){if(null!=this.$ghost){this.$ghost.classList.remove(this.options.ghost),this.moveGhost(t);let s=this.Masis.$element.querySelector("#"+this.options.exclude);this.$ghost.setAttribute(this.options.attr,s.getAttribute(this.options.attr)),this.Masis.$element.removeChild(s),this.Masis.$element.appendChild(this.$ghost),MasisPosition(MasisSort(this.Masis.populate(),"[data-sort]")),this.redefineSort(),this.oldpos="",this.onDrag=!1,Yadoms.triggerEvent("masis.moved")}}}
class MasisResize{Masis=null;options={};onResize=!1;$element;offsetX;offsetY;previousX;previousY;constructor(e,t){this.Masis=e,this.options=t;document.addEventListener("mousemove",e=>{this.resize(e)},!1),document.addEventListener("mouseup",e=>{this.deleteResize(e)},!1)}init(){let e=this;this.Masis.$children.forEach(t=>{let s=document.createElement("div");s.classList.add(e.options.class),s.addEventListener("mousedown",t=>{e.createResize(t)},!1),t.appendChild(s)})}createResize(e){e.preventDefault(),e.stopImmediatePropagation(),e.target.classList.contains(this.options.class)&&(this.onResize=!0,this.$element=e.currentTarget.parentNode,this.$element.classList.add(this.options.active),this.offsetX=0,this.offsetY=0,this.previousX=e.pageX,this.previousY=e.pageY)}deleteResize(){if(this.onResize=!1,this.$element){this.$element.classList.remove(this.options.active);let e=this;Yadoms.triggerEvent("masis.resize",{element:e.$element}),this.options.callbackEnd(this.$element)}this.$element=null}resize(e){if(this.onResize&&(e.preventDefault(),null!=this.$element)){let t=this.options.breakpoints.width.length-1,s=this.options.breakpoints.height.length-1;this.offsetX+=e.pageX-this.previousX,this.offsetY+=e.pageY-this.previousY,this.previousX=e.pageX,this.previousY=e.pageY;for(let e in this.options.breakpoints.width)if(this.options.breakpoints.width[e]>Math.abs(this.offsetX)){t=parseInt(e);break}for(let e in this.options.breakpoints.height)if(this.options.breakpoints.height[e]>Math.abs(this.offsetY)){s=parseInt(e);break}this.offsetX<0&&(t*=-1),this.offsetY<0&&(s*=-1),this.options.callbackMove(this.$element,t,s)}}}